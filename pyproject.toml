[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "shieldops"
version = "0.1.0"
description = "AI-Powered Autonomous SRE Platform"
readme = "README.md"
license = "LicenseRef-Proprietary"
requires-python = ">=3.12"
authors = [
    { name = "ShieldOps Team" },
]

dependencies = [
    # Agent Framework
    "langgraph>=0.2.0",
    "langchain-core>=0.3.0",
    "langchain-anthropic>=0.3.0",
    "langchain-openai>=0.3.0",
    "langsmith>=0.2.0",

    # API Framework
    "fastapi>=0.115.0",
    "uvicorn[standard]>=0.32.0",
    "pydantic>=2.10.0",
    "pydantic-settings>=2.6.0",

    # Database & Messaging
    "sqlalchemy[asyncio]>=2.0.0",
    "asyncpg>=0.30.0",
    "alembic>=1.14.0",
    "redis>=5.2.0",
    "aiokafka>=0.12.0",

    # Infrastructure Connectors
    "boto3>=1.35.0",
    "kubernetes>=31.0.0",
    "asyncssh>=2.17.0",

    # Observability
    "opentelemetry-api>=1.28.0",
    "opentelemetry-sdk>=1.28.0",
    "opentelemetry-exporter-otlp-proto-grpc>=1.28.0",
    "opentelemetry-instrumentation-fastapi>=0.49b0",
    "opentelemetry-instrumentation-sqlalchemy>=0.49b0",
    "opentelemetry-instrumentation-redis>=0.49b0",
    "opentelemetry-instrumentation-httpx>=0.49b0",
    "structlog>=24.4.0",

    # Policy Engine
    "opa-python-client>=1.3.0",

    # Auth
    "passlib[bcrypt]>=1.7.4",

    # Utilities
    "httpx>=0.28.0",
    "pyyaml>=6.0.0",
    "jinja2>=3.1.0",
    "click>=8.1.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.3.0",
    "pytest-asyncio>=0.24.0",
    "pytest-cov>=6.0.0",
    "pytest-mock>=3.14.0",
    "pytest-benchmark>=4.0.0",
    "ruff>=0.8.0",
    "mypy>=1.13.0",
    "pre-commit>=4.0.0",
    "faker>=33.0.0",
    "moto[s3,ec2,ecs,cloudtrail]>=5.0.0",
    "locust>=2.29.0",
]
dashboard = [
    "streamlit>=1.41.0",
    "plotly>=5.24.0",
]

[project.scripts]
shieldops = "shieldops.cli:main"

[tool.ruff]
line-length = 100
target-version = "py312"

[tool.ruff.lint]
select = ["E", "F", "I", "N", "W", "UP", "B", "SIM", "S"]
ignore = ["S101"]  # Allow assert in tests

[tool.ruff.lint.per-file-ignores]
"src/shieldops/api/**/*.py" = ["B008"]  # Depends(), Query(), Body() in FastAPI signatures
"tests/**/*.py" = ["S106"]  # Hardcoded test tokens/passwords are expected in tests

[tool.ruff.lint.isort]
known-first-party = ["shieldops"]

[tool.pytest.ini_options]
testpaths = ["tests"]
asyncio_mode = "auto"
addopts = "-v --tb=short"
markers = [
    "integration: marks tests as integration tests (may require external services)",
]

[tool.mypy]
python_version = "3.12"
strict = true
warn_return_any = true
warn_unused_configs = true
warn_unused_ignores = false  # type: ignore comments must work across local + pre-commit envs

[[tool.mypy.overrides]]
module = [
    "boto3",
    "boto3.*",
    "botocore.*",
    "streamlit",
    "streamlit.*",
    "plotly",
    "plotly.*",
    "kubernetes_asyncio",
    "kubernetes_asyncio.*",
    "google.cloud",
    "google.cloud.*",
    "azure.identity",
    "azure.mgmt.*",
    "aiosmtplib",
    "opentelemetry",
    "opentelemetry.*",
    "moto",
    "moto.*",
    "locust",
    "locust.*",
]
ignore_missing_imports = true

[tool.coverage.run]
source = ["src/shieldops"]
omit = ["*/tests/*", "*/__pycache__/*"]

[tool.coverage.report]
fail_under = 80
show_missing = true
