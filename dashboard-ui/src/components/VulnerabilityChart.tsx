import {
  PieChart,
  Pie,
  Cell,
  ResponsiveContainer,
  Tooltip,
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
} from "recharts";

const SEVERITY_COLORS: Record<string, string> = {
  critical: "#ef4444",
  high: "#f97316",
  medium: "#eab308",
  low: "#22c55e",
};

// ── Severity Pie Chart ────────────────────────────────────────────────

interface SeverityPieProps {
  data: Record<string, number>;
}

export function SeverityPieChart({ data }: SeverityPieProps) {
  const chartData = Object.entries(data).map(([name, value]) => ({
    name,
    value,
    fill: SEVERITY_COLORS[name] ?? "#6b7280",
  }));

  return (
    <div>
      <ResponsiveContainer width="100%" height={220}>
        <PieChart>
          <Pie
            data={chartData}
            dataKey="value"
            nameKey="name"
            cx="50%"
            cy="50%"
            outerRadius={80}
            innerRadius={50}
            paddingAngle={2}
          >
            {chartData.map((entry, idx) => (
              <Cell key={idx} fill={entry.fill} />
            ))}
          </Pie>
          <Tooltip
            contentStyle={{
              backgroundColor: "#1f2937",
              border: "1px solid #374151",
              borderRadius: "8px",
              fontSize: "12px",
            }}
          />
        </PieChart>
      </ResponsiveContainer>
      <div className="mt-2 flex justify-center gap-4">
        {chartData.map((d) => (
          <div key={d.name} className="flex items-center gap-1.5 text-xs">
            <span
              className="h-2 w-2 rounded-full"
              style={{ backgroundColor: d.fill }}
            />
            <span className="capitalize text-gray-400">{d.name}</span>
            <span className="font-medium text-gray-200">{d.value}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

// ── Vulnerability Trend Line ──────────────────────────────────────────

interface TrendLineProps {
  data: Array<{ date: string; count: number }>;
}

export function VulnerabilityTrendLine({ data }: TrendLineProps) {
  return (
    <ResponsiveContainer width="100%" height={220}>
      <LineChart data={data}>
        <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
        <XAxis dataKey="date" stroke="#6b7280" fontSize={11} />
        <YAxis stroke="#6b7280" fontSize={11} />
        <Tooltip
          contentStyle={{
            backgroundColor: "#1f2937",
            border: "1px solid #374151",
            borderRadius: "8px",
          }}
        />
        <Line
          type="monotone"
          dataKey="count"
          stroke="#6366f1"
          strokeWidth={2}
          dot={false}
        />
      </LineChart>
    </ResponsiveContainer>
  );
}
