<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShieldOps Daily Security Digest</title>
</head>
<body style="margin: 0; padding: 0; background-color: #1a1a2e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; color: #e0e0e0;">
  <!-- Wrapper -->
  <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #1a1a2e;">
    <tr>
      <td align="center" style="padding: 20px 0;">
        <table role="presentation" width="600" cellpadding="0" cellspacing="0" style="max-width: 600px; width: 100%;">

          <!-- Header -->
          <tr>
            <td style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 30px 40px; border-radius: 12px 12px 0 0; text-align: center;">
              <table role="presentation" width="100%" cellpadding="0" cellspacing="0">
                <tr>
                  <td align="center">
                    <span style="font-size: 36px;">&#x1F6E1;</span>
                    <h1 style="margin: 10px 0 5px 0; font-size: 24px; color: #ffffff; font-weight: 700;">ShieldOps</h1>
                    <p style="margin: 0; font-size: 14px; color: #a0c4ff; text-transform: uppercase; letter-spacing: 2px;">Daily Security Digest</p>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- Period -->
          <tr>
            <td style="background-color: #16213e; padding: 16px 40px; border-bottom: 1px solid #0f3460;">
              <p style="margin: 0; font-size: 13px; color: #8899aa;">
                Period: {{ digest.period_start[:10] }} to {{ digest.period_end[:10] }}
                {% if digest.team_id %} | Team: {{ digest.team_id }}{% endif %}
              </p>
            </td>
          </tr>

          <!-- Sections -->
          {% for section in digest.sections %}
          <tr>
            <td style="background-color: #16213e; padding: 24px 40px; border-bottom: 1px solid #0f3460;">

              <!-- Section Title -->
              <h2 style="margin: 0 0 16px 0; font-size: 18px; color: #ffffff; border-left: 3px solid #e94560; padding-left: 12px;">
                {{ section.title }}
              </h2>

              {% if section.title == "New Vulnerabilities" %}
                <!-- Severity Summary -->
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="margin-bottom: 16px;">
                  <tr>
                    <td style="padding: 4px 0;">
                      <span style="font-size: 28px; font-weight: 700; color: #ffffff;">{{ section.content.total }}</span>
                      <span style="font-size: 14px; color: #8899aa; margin-left: 8px;">new vulnerabilities</span>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 8px 0;">
                      {% for sev, count in section.content.by_severity.items() %}
                        {% if sev == "critical" %}
                          <span style="display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #dc3545; color: #ffffff; margin-right: 6px;">CRITICAL: {{ count }}</span>
                        {% elif sev == "high" %}
                          <span style="display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #e8850c; color: #ffffff; margin-right: 6px;">HIGH: {{ count }}</span>
                        {% elif sev == "medium" %}
                          <span style="display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #c4a800; color: #1a1a2e; margin-right: 6px;">MEDIUM: {{ count }}</span>
                        {% elif sev == "low" %}
                          <span style="display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #28a745; color: #ffffff; margin-right: 6px;">LOW: {{ count }}</span>
                        {% else %}
                          <span style="display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #6c757d; color: #ffffff; margin-right: 6px;">{{ sev | upper }}: {{ count }}</span>
                        {% endif %}
                      {% endfor %}
                    </td>
                  </tr>
                </table>

                <!-- Vulnerability Table -->
                {% if section.content.vulnerabilities %}
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="font-size: 13px;">
                  <tr>
                    <td style="padding: 8px 0; color: #8899aa; border-bottom: 1px solid #0f3460; font-weight: 600;">CVE</td>
                    <td style="padding: 8px 0; color: #8899aa; border-bottom: 1px solid #0f3460; font-weight: 600;">Severity</td>
                    <td style="padding: 8px 0; color: #8899aa; border-bottom: 1px solid #0f3460; font-weight: 600;">Description</td>
                  </tr>
                  {% for vuln in section.content.vulnerabilities[:10] %}
                  <tr>
                    <td style="padding: 6px 0; border-bottom: 1px solid #1a1a2e; color: #a0c4ff; font-family: monospace; font-size: 12px;">{{ vuln.cve_id or vuln.id }}</td>
                    <td style="padding: 6px 0; border-bottom: 1px solid #1a1a2e;">
                      {% if vuln.severity == "critical" %}
                        <span style="color: #dc3545; font-weight: 600;">&#9679; Critical</span>
                      {% elif vuln.severity == "high" %}
                        <span style="color: #e8850c; font-weight: 600;">&#9679; High</span>
                      {% elif vuln.severity == "medium" %}
                        <span style="color: #c4a800; font-weight: 600;">&#9679; Medium</span>
                      {% else %}
                        <span style="color: #28a745; font-weight: 600;">&#9679; Low</span>
                      {% endif %}
                    </td>
                    <td style="padding: 6px 0; border-bottom: 1px solid #1a1a2e; color: #cccccc;">{{ vuln.title[:80] }}</td>
                  </tr>
                  {% endfor %}
                </table>
                {% endif %}

              {% elif section.title == "SLA Status" %}
                <!-- SLA Breaches -->
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0">
                  <tr>
                    <td style="padding: 12px 16px; background-color: {% if section.content.breached > 0 %}#3d1520{% else %}#1a2e1a{% endif %}; border-radius: 8px;">
                      <span style="font-size: 32px; font-weight: 700; color: {% if section.content.breached > 0 %}#dc3545{% else %}#28a745{% endif %};">{{ section.content.breached }}</span>
                      <span style="font-size: 14px; color: #cccccc; margin-left: 8px;">SLA breaches</span>
                    </td>
                  </tr>
                </table>
                {% if section.content.breached_vulns %}
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="margin-top: 12px; font-size: 13px;">
                  {% for vuln in section.content.breached_vulns[:5] %}
                  <tr>
                    <td style="padding: 4px 0; color: #a0c4ff; font-family: monospace; font-size: 12px;">{{ vuln.cve_id or vuln.id }}</td>
                    <td style="padding: 4px 0; color: #dc3545;">{{ vuln.severity }}</td>
                    <td style="padding: 4px 0; color: #8899aa;">Due: {{ vuln.sla_due_at[:10] if vuln.sla_due_at else "N/A" }}</td>
                  </tr>
                  {% endfor %}
                </table>
                {% endif %}

              {% elif section.title == "Remediation Progress" %}
                <!-- Remediation Stats -->
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0">
                  <tr>
                    <td width="25%" style="text-align: center; padding: 12px 4px;">
                      <div style="font-size: 24px; font-weight: 700; color: #e94560;">{{ section.content.total_open }}</div>
                      <div style="font-size: 11px; color: #8899aa; margin-top: 4px;">Open</div>
                    </td>
                    <td width="25%" style="text-align: center; padding: 12px 4px;">
                      <div style="font-size: 24px; font-weight: 700; color: #a0c4ff;">{{ section.content.remediated }}</div>
                      <div style="font-size: 11px; color: #8899aa; margin-top: 4px;">Remediated</div>
                    </td>
                    <td width="25%" style="text-align: center; padding: 12px 4px;">
                      <div style="font-size: 24px; font-weight: 700; color: #28a745;">{{ section.content.verified }}</div>
                      <div style="font-size: 11px; color: #8899aa; margin-top: 4px;">Verified</div>
                    </td>
                    <td width="25%" style="text-align: center; padding: 12px 4px;">
                      <div style="font-size: 24px; font-weight: 700; color: #6c757d;">{{ section.content.closed }}</div>
                      <div style="font-size: 11px; color: #8899aa; margin-top: 4px;">Closed</div>
                    </td>
                  </tr>
                </table>
                {% if section.content.mttr_hours %}
                <p style="margin: 12px 0 0 0; font-size: 13px; color: #8899aa;">
                  Mean Time to Remediate: <strong style="color: #a0c4ff;">{{ section.content.mttr_hours }}h</strong>
                </p>
                {% endif %}

              {% elif section.title == "Security Posture" %}
                <!-- Posture Trend -->
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0">
                  <tr>
                    <td style="padding: 12px 16px; background-color: #1a2435; border-radius: 8px;">
                      {% if section.content.current_score is not none %}
                        <span style="font-size: 36px; font-weight: 700; color: {% if section.content.trend == 'improving' %}#28a745{% elif section.content.trend == 'declining' %}#dc3545{% else %}#a0c4ff{% endif %};">
                          {{ section.content.current_score }}
                        </span>
                        <span style="font-size: 14px; color: #8899aa;">/100</span>
                        {% if section.content.delta is not none %}
                          <span style="font-size: 14px; margin-left: 12px; color: {% if section.content.delta > 0 %}#28a745{% elif section.content.delta < 0 %}#dc3545{% else %}#8899aa{% endif %};">
                            {% if section.content.delta > 0 %}&#9650; +{{ section.content.delta }}{% elif section.content.delta < 0 %}&#9660; {{ section.content.delta }}{% else %}&#9654; No change{% endif %}
                          </span>
                        {% endif %}
                      {% else %}
                        <span style="font-size: 14px; color: #8899aa;">No posture data available</span>
                      {% endif %}
                    </td>
                  </tr>
                </table>

              {% elif section.title == "Top Risks" %}
                <!-- Top Risks -->
                {% for risk in section.content.risks[:5] %}
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="margin-bottom: 8px;">
                  <tr>
                    <td style="padding: 10px 14px; background-color: #2a1525; border-radius: 6px; border-left: 3px solid #dc3545;">
                      <div style="font-size: 13px; font-weight: 600; color: #ffffff;">
                        {{ risk.cve_id or risk.id }}
                        <span style="font-size: 11px; color: #dc3545; margin-left: 8px;">{{ risk.severity | upper }}</span>
                        <span style="font-size: 11px; color: #8899aa; margin-left: 8px;">{{ risk.days_open }}d open</span>
                      </div>
                      <div style="font-size: 12px; color: #cccccc; margin-top: 4px;">{{ risk.description[:120] }}</div>
                      {% if risk.affected_resource %}
                      <div style="font-size: 11px; color: #8899aa; margin-top: 4px;">Resource: {{ risk.affected_resource }}</div>
                      {% endif %}
                    </td>
                  </tr>
                </table>
                {% endfor %}

              {% else %}
                <!-- Generic Section -->
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0">
                  {% for key, value in section.content.items() %}
                  <tr>
                    <td style="padding: 4px 0; font-size: 13px; color: #8899aa;">{{ key }}:</td>
                    <td style="padding: 4px 0; font-size: 13px; color: #cccccc;">{{ value }}</td>
                  </tr>
                  {% endfor %}
                </table>
              {% endif %}
            </td>
          </tr>
          {% endfor %}

          <!-- Footer -->
          <tr>
            <td style="background-color: #0f3460; padding: 24px 40px; border-radius: 0 0 12px 12px; text-align: center;">
              <p style="margin: 0 0 8px 0; font-size: 12px; color: #8899aa;">
                Generated by ShieldOps Security Platform
              </p>
              <p style="margin: 0; font-size: 11px; color: #556677;">
                {{ digest.generated_at[:19] }} UTC | To adjust preferences, visit your ShieldOps dashboard.
              </p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>
